<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleurarose Booking</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:system-ui,-apple-system,sans-serif;margin:16px}
    .card{max-width:560px;margin:auto;border:1px solid #ddd;border-radius:14px;padding:14px}
    h2{margin:0 0 6px 0}
    .muted{color:#666;font-size:13px;margin:0 0 10px 0}
    label{display:block;margin-top:10px;font-weight:700}
    input,select,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #ccc;margin-top:6px;font-size:16px}
    textarea{resize:vertical}
    button{width:100%;padding:14px;border-radius:12px;border:0;margin-top:14px;font-weight:800;font-size:16px}
    button:disabled{opacity:.45}
    .row{display:flex;gap:10px}
    .row>div{flex:1}
    .err{color:#b00020;margin-top:8px}
    .ok{color:#0a7a2f;margin-top:8px}
    .small{font-size:12px;color:#666;margin-top:6px}
  </style>
</head>
<body>
  <div class="card">
    <h2>จองคิวถ่ายภาพ</h2>
    <p class="muted">รอแอดมินยืนยันก่อน • มัดจำ 2,000 บาท (ไม่คืน)</p>

    <label>ชื่อ-นามสกุล</label>
    <input id="customer_name" placeholder="ชื่อ-นามสกุล" />

    <label>เบอร์โทร</label>
    <input id="phone" inputmode="tel" placeholder="09xxxxxxxx" />

    <div class="row">
      <div>
        <label>วันที่</label>
        <input id="event_date" type="date" />
      </div>
      <div>
        <label>รอบ</label>
        <select id="time_slot">
          <option value="AM">เช้า 10:00–14:00</option>
          <option value="PM">เย็น 18:00–22:00</option>
        </select>
      </div>
    </div>

    <label>ประเภทงาน</label>
    <select id="job_type">
      <option value="Photobooth">Photobooth</option>
      <option value="Telephone Booth">Telephone Booth</option>
    </select>

    <label>สถานที่</label>
    <input id="location" placeholder="เช่น Bangkok / สถานที่จัดงาน" />

    <label>หมายเหตุ</label>
    <textarea id="notes" rows="3" placeholder="รายละเอียดเพิ่มเติม (ถ้ามี)"></textarea>

    <label style="display:flex;gap:10px;align-items:flex-start;margin-top:12px;font-weight:700">
      <input id="agree" type="checkbox" style="width:auto;margin-top:4px" />
      <span>ยอมรับเงื่อนไขมัดจำ 2,000 บาท (ไม่สามารถขอคืนได้)</span>
    </label>
    <div class="small">หากต้องการแบ่งย่อยงาน/ปรับรายละเอียดเพิ่มเติม โปรดติดต่อแอดมิน</div>

    <button id="submit" disabled>ส่งคำขอจอง</button>
    <div id="status" class="muted"></div>
  </div>

<script>
  // LIFF + WebApp
  const LIFF_ID = "2008882886-ubJheqfN";
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzaJSmFOCc5lxZTydACnuPxHFK-TTCniAb2lqaoO3Q93zSwSdJCEodMSTiUyPQhBddp/exec";

  const $ = (id) => document.getElementById(id);

  function validate(){
    const ok =
      $("agree").checked &&
      $("customer_name").value.trim() &&
      $("phone").value.trim() &&
      $("event_date").value &&
      $("time_slot").value &&
      $("job_type").value;
    $("submit").disabled = !ok;
  }

  ["customer_name","phone","event_date","time_slot","job_type","location","notes","agree"].forEach(id=>{
    $(id).addEventListener("input", validate);
    $(id).addEventListener("change", validate);
  });

  async function init(){
    await liff.init({ liffId: LIFF_ID });
    if(!liff.isLoggedIn()){
      liff.login();
      return;
    }
    validate();
  }

  $("submit").addEventListener("click", async ()=>{
    $("status").className = "muted";
    $("status").textContent = "กำลังส่งคำขอ...";

    try{
      const profile = await liff.getProfile();

      const payload = {
        line_user_id: profile.userId,
        customer_name: $("customer_name").value.trim(),
        phone: $("phone").value.trim(),
        event_date: $("event_date").value,     // YYYY-MM-DD
        time_slot: $("time_slot").value,       // AM/PM
        job_type: $("job_type").value,         // Photobooth / Telephone Booth
        location: $("location").value.trim(),
        notes: $("notes").value.trim()
      };

      const res = await fetch(WEBAPP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if(!data.ok){
        throw new Error(data.message || "ส่งไม่สำเร็จ");
      }

      $("status").className = "ok";
      $("status").textContent = "ส่งคำขอเรียบร้อย ✅ รอแอดมินยืนยันในแชทนี้ค่ะ";

      // ปิดหน้าหลังส่งสำเร็จ (เลือกได้)
      // setTimeout(()=>liff.closeWindow(), 1200);

    }catch(err){
      $("status").className = "err";
      $("status").textContent = "ผิดพลาด: " + err.message;
    }
  });

  init();
</script>
</body>
</html>
