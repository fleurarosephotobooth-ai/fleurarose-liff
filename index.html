<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fleurarose Booking</title>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f6f6f6;
      padding: 16px;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      max-width: 480px;
      margin: auto;
      box-shadow: 0 6px 20px rgba(0,0,0,.08);
    }
    h1 { margin-top: 0; }
    label { display: block; margin-top: 14px; font-weight: 600; }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid #ddd;
      margin-top: 6px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      margin-top: 18px;
      font-size: 18px;
    }
    .submit {
      background: #000;
      color: #fff;
    }
    .admin {
      background: #eee;
    }
    .hint {
      font-size: 13px;
      color: #666;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Fleurarose Booking</h1>
    <div id="hello"></div>

    <label>ชื่อ-นามสกุล</label>
    <input id="name">

    <label>เบอร์โทร</label>
    <input id="phone">

    <label>วันที่</label>
    <input id="date" type="date">

    <label>รอบ</label>
    <select id="slot">
      <option value="AM">เช้า 10:00–14:00</option>
      <option value="PM">เย็น 18:00–22:00</option>
    </select>

    <label>ประเภทงาน</label>
    <select id="jobType">
      <option>Photobooth</option>
      <option>Automate</option>
      <option>Telephone booth สีฟ้าขาว 1</option>
      <option>Telephone booth สีฟ้าขาว 2</option>
      <option>Telephone booth สีน้ำตาล</option>
    </select>

    <label>สถานที่</label>
    <input id="location">

    <label>หมายเหตุ</label>
    <textarea id="notes"></textarea>

    <button class="submit" id="submitBtn" onclick="submitBooking()">
      ส่งคำขอจอง
    </button>

    <button class="admin" onclick="openAdmin()">
      ติดต่อแอดมิน
    </button>

    <div class="hint">
      * ชำระมัดจำหลังแอดมินยืนยันเท่านั้น
    </div>
  </div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxsQpFCHld0vVim-VJcKg58Rf8ZKQevL73_Q3993kkbZiuKOq-IXMM3UR1xO-1i1LSl/exec";
const LIFF_ID = "2008882886-ubJheqfN";

let lineUserId = "";
let displayName = "";

async function init() {
  try {
    await liff.init({ liffId: LIFF_ID });
    if (liff.isLoggedIn()) {
      const profile = await liff.getProfile();
      lineUserId = profile.userId;
      displayName = profile.displayName;
      document.getElementById("hello").innerText = "สวัสดี " + displayName;
    }
  } catch (e) {
    console.log("LIFF not available");
  }
}

async function submitBooking() {
  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  btn.innerText = "กำลังส่งคำขอจอง...";

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        lineUserId,
        displayName,
        customerName: name.value,
        phone: phone.value,
        eventDate: date.value,
        timeSlot: slot.value,
        jobType: jobType.value,
        location: location.value,
        notes: notes.value
      })
    });

    const json = await res.json();

    if (!json.ok) throw new Error(json.error);

    alert("ส่งคำขอจองเรียบร้อย");
    btn.innerText = "ส่งแล้ว";

  } catch (err) {
    alert("ส่งไม่สำเร็จ: " + err.message);
    btn.disabled = false;
    btn.innerText = "ส่งคำขอจอง";
  }
}

function openAdmin() {
  window.open("https://line.me/R/ti/p/@262clszf", "_blank");
}

init();
</script>
</body>
</html>
