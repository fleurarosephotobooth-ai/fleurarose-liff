<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleurarose Booking</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --primary:#111827;
      --primary2:#374151;
      --ok:#16a34a;
      --bad:#dc2626;
      --shadow:0 10px 25px rgba(0,0,0,.08);
      --radius:18px;
    }
    body{margin:0;background:var(--bg);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",Arial;}
    .wrap{max-width:720px;margin:0 auto;padding:22px;}
    .brand{display:flex;align-items:center;gap:12px;margin:8px 0 14px;}
    .logo{
      width:42px;height:42px;border-radius:14px;background:#111827;color:#fff;
      display:grid;place-items:center;font-weight:800;letter-spacing:.5px;
      box-shadow:var(--shadow);
    }
    .brand h1{font-size:22px;margin:0;color:var(--text);}
    .brand p{margin:2px 0 0;color:var(--muted);font-size:13px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);}
    .card .hd{padding:16px 16px 6px}
    .card .hd .sub{color:var(--muted);font-size:13px;margin-top:6px;line-height:1.4}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 16px 16px}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    label{font-size:13px;color:var(--muted);display:block;margin:2px 0 6px}
    input,select,textarea{
      width:100%;box-sizing:border-box;border:1px solid var(--line);border-radius:14px;
      padding:12px 12px;background:#fff;font-size:15px;outline:none;color:var(--text);
    }
    textarea{min-height:92px;resize:vertical}
    input:focus,select:focus,textarea:focus{border-color:#9ca3af;box-shadow:0 0 0 4px rgba(17,24,39,.06)}
    .row{grid-column:1/-1}
    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:8px 10px;border-radius:999px;background:#f3f4f6;border:1px solid var(--line);
      font-size:13px;color:var(--muted)
    }
    .btnbar{display:flex;gap:10px;flex-wrap:wrap;padding:0 16px 16px}
    .btn{
      border:none;border-radius:16px;padding:13px 16px;font-size:15px;font-weight:700;
      cursor:pointer;transition:.15s transform,.15s opacity;
    }
    .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--primary);color:#fff;flex:1}
    .btn.ghost{background:#fff;color:var(--primary);border:1px solid var(--line)}
    .terms{display:flex;gap:10px;align-items:flex-start;padding:0 16px 12px}
    .terms input{width:auto;margin-top:4px}
    .terms .t{font-size:13px;color:var(--muted);line-height:1.45}
    .msg{padding:0 16px 16px;font-size:14px}
    .msg.ok{color:var(--ok)}
    .msg.bad{color:var(--bad)}
    .mini{font-size:12px;color:var(--muted);padding:0 16px 16px}
    .hide{display:none}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo">FR</div>
      <div>
        <h1>Fleurarose Booking</h1>
        <p id="who">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE‚Ä¶</p>
      </div>
    </div>

    <div class="card">
      <div class="hd">
        <div class="pill">üìå ‡∏ä‡∏≥‡∏£‡∏∞ ‚Äú‡∏°‡∏±‡∏î‡∏à‡∏≥ 2,000 ‡∏ö‡∏≤‡∏ó‚Äù ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
        <div class="sub">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô/‡∏£‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß<br/>
          ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‚Äú‡πÅ‡∏ö‡πà‡∏á‡∏¢‡πà‡∏≠‡∏¢‡∏á‡∏≤‡∏ô‚Äù ‡πÉ‡∏´‡πâ‡∏Å‡∏î <b>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</b>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
          <input id="customer_name" placeholder="‡πÄ‡∏ä‡πà‡∏ô Mew..." />
        </div>

        <div>
          <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label>
          <input id="phone" inputmode="tel" placeholder="0XXXXXXXXX" />
        </div>

        <div>
          <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
          <input id="event_date" type="date" />
        </div>

        <div>
          <label>‡∏£‡∏≠‡∏ö</label>
          <select id="time_slot">
            <option value="AM">‡πÄ‡∏ä‡πâ‡∏≤ 10:00‚Äì14:00</option>
            <option value="PM">‡πÄ‡∏¢‡πá‡∏ô 18:00‚Äì22:00</option>
          </select>
        </div>

        <div class="row">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
          <select id="job_type">
            <option>Photobooth</option>
            <option>Automate</option>
            <option>Telephone booth ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß 1</option>
            <option>Telephone booth ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß 2</option>
            <option>Telephone booth ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</option>
          </select>
        </div>

        <div class="row">
          <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
          <input id="location" placeholder="‡πÄ‡∏ä‡πà‡∏ô BKK / ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏Ç‡∏ï" />
        </div>

        <div class="row">
          <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
          <textarea id="notes" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô 10:00 ‡∏ï‡∏£‡∏á / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô"></textarea>
        </div>
      </div>

      <div class="terms">
        <input id="agree" type="checkbox" />
        <div class="t">
          ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏°‡∏±‡∏î‡∏à‡∏≥ 2,000 ‡∏ö‡∏≤‡∏ó (‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ) ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥
        </div>
      </div>

      <div class="btnbar">
        <button class="btn primary" id="btnSubmit">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á</button>
        <button class="btn ghost" id="btnAdmin">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
      </div>

      <div id="msg" class="msg hide"></div>
      <div class="mini">‡∏´‡∏≤‡∏Å‡∏Å‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î-‡πÄ‡∏õ‡∏¥‡∏î LIFF ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Browser ‡∏õ‡∏Å‡∏ï‡∏¥</div>
    </div>
  </div>

<script>
  // ====== CONFIG ======
  const LIFF_ID = "2008882886-ubJheqfN";
  const GAS_URL = "https://script.google.com/macros/s/AKfycbygjJqJFAzwqJLBIfJ3OpFHD8EqZyPdfND0GVkYMsWSLDD6apwCBfiKYpkSSbvJXVRf/exec";
  const OA_BASIC_ID = "@262clszf";
  // ====================

  let profile = null;

  const $ = (id) => document.getElementById(id);
  const setMsg = (text, type) => {
    const el = $("msg");
    el.className = "msg " + (type || "");
    el.textContent = text;
    el.classList.remove("hide");
  };

  function todayLocalISO(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  async function initLIFF(){
    await liff.init({ liffId: LIFF_ID });
    if (!liff.isLoggedIn()) liff.login();

    profile = await liff.getProfile();
    $("who").textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${profile.displayName} üëã`;
    $("event_date").value = todayLocalISO();
  }

  $("btnAdmin").onclick = () => {
    // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ä‡∏ó OA (‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå ‚Äú‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‚Äù)
    liff.openWindow({
      url: `https://line.me/R/oaMessage/${encodeURIComponent(OA_BASIC_ID)}`,
      external: true
    });
  };

  $("btnSubmit").onclick = async () => {
    try{
      $("btnSubmit").disabled = true;
      setMsg("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‚Ä¶", "");

      if (!profile) throw new Error("‡∏¢‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      const customer_name = $("customer_name").value.trim();
      const phone = $("phone").value.trim();
      const event_date = $("event_date").value;
      const time_slot = $("time_slot").value;
      const job_type = $("job_type").value;
      const location = $("location").value.trim();
      const notes = $("notes").value.trim();
      const agree = $("agree").checked;

      if (!customer_name) throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•");
      if (!phone) throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£");
      if (!event_date) throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
      if (!agree) throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡πä‡∏Å‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏°‡∏±‡∏î‡∏à‡∏≥");

      const payload = {
        line_user_id: profile.userId,
        line_display_name: profile.displayName,
        customer_name,
        phone,
        event_date,     // YYYY-MM-DD
        time_slot,      // AM/PM
        job_type,
        location,
        notes
      };

      const res = await fetch(GAS_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
        redirect: "follow"
      });

      const text = await res.text();
      let data = {};
      try{ data = JSON.parse(text); } catch(e){ data = { ok:false, message:text }; }

      if (!data.ok) throw new Error(data.message || "‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      if (data.status === "Rejected") {
        setMsg("‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß üò• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô/‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô", "bad");
      } else {
        setMsg(`‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ (Booking: ${data.booking_id})\n‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: Pending ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô`, "ok");
      }

    }catch(err){
      setMsg(String(err.message || err), "bad");
    }finally{
      $("btnSubmit").disabled = false;
    }
  };

  initLIFF().catch(e => setMsg("‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (LIFF) ‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", "bad"));
</script>
</body>
</html>
