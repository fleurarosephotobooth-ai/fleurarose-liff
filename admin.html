<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fleurarose Admin</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body{font-family:system-ui; padding:16px; max-width:520px; margin:auto;}
    .card{border:1px solid #ddd; border-radius:14px; padding:14px;}
    button{width:100%; padding:14px; border-radius:12px; border:0; font-size:16px;}
    .primary{background:#111; color:#fff;}
    .muted{color:#666; font-size:13px;}
    .ok{color:green;}
    .err{color:#c00;}
  </style>
</head>
<body>
  <h2>Admin Action</h2>
  <div class="card">
    <div class="muted">Booking ID</div>
    <div id="bid" style="font-weight:700; font-size:18px;">-</div>
    <div style="height:12px"></div>
    <button class="primary" id="btn">ดันแชทลูกค้าขึ้นบนสุด (Ping)</button>
    <div style="height:12px"></div>
    <div id="msg" class="muted"></div>
  </div>

<script>
  // ใส่ค่า 2 อย่างนี้ให้ถูก
  const LIFF_ID = "2008882886-ubJheqfN"; // ของหมิว
  const GAS_WEBAPP_URL = "PUT_YOUR_GAS_EXEC_URL_HERE"; // ตัว /exec ของ Web App

  function getParam(name){
    const u = new URL(location.href);
    return u.searchParams.get(name) || "";
  }

  async function main(){
    const bookingId = getParam("booking_id");
    document.getElementById("bid").textContent = bookingId || "-";

    await liff.init({ liffId: LIFF_ID });

    document.getElementById("btn").onclick = async () => {
      if(!bookingId){
        document.getElementById("msg").innerHTML = `<span class="err">ไม่พบ booking_id</span>`;
        return;
      }
      document.getElementById("msg").textContent = "กำลังส่ง...";
      try{
        const url = `${GAS_WEBAPP_URL}?action=ping&booking_id=${encodeURIComponent(bookingId)}`;
        const res = await fetch(url, { method:"GET" });
        const json = await res.json();
        if(json.ok){
          document.getElementById("msg").innerHTML = `<span class="ok">ส่งแล้ว ✅ แชทจะเด้งขึ้นบนสุดใน OA</span>`;
        }else{
          document.getElementById("msg").innerHTML = `<span class="err">ผิดพลาด: ${json.message}</span>`;
        }
      }catch(e){
        document.getElementById("msg").innerHTML = `<span class="err">Fetch failed: ${e}</span>`;
      }
    };
  }
  main();
</script>
</body>
</html>
